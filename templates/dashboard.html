<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <!-- Navbar with Offcanvas Trigger -->
  <nav class="navbar navbar-light bg-light">
    <div class="container-fluid">
      <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
        Menu
      </button>
      <span class="navbar-brand mb-0 h1">Dashboard</span>
    </div>
  </nav>

  <!-- Offcanvas Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Navigation</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('profile') }}">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('activity') }}">Activity</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('recommendations') }}">Recommendations</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Dashboard Content -->
  <div class="container mt-4">
    <div class="row">
      <!-- Left Section: Today's Tasks -->
      <div class="col-md-8">
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5>Today's Tasks</h5>
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTaskModal">
              Add Task
            </button>
          </div>
          <div class="card-body">
            <div class="list-group">
              {% for task in tasks %}
              <div class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <h6>{{ task.name }}</h6>
                  <p class="mb-1">Deadline: {{ task.deadline }}</p>
                  <p class="mb-0">Estimated: {{ task.estimated_time }} mins</p>
                </div>
                <div>
                  <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
                  <!-- Additional buttons like start/stop can be added here -->
                </div>
              </div>
              {% else %}
              <p class="text-muted">No tasks for today!</p>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <!-- Right Section: Activity and Recommendations -->
      <div class="col-md-4">
        <!-- Activity Box -->
        <div class="card mb-4">
          <div class="card-header">
            <h5>Weekly Activity</h5>
          </div>
          <div class="card-body">
            <!-- Placeholder for a bar chart -->
            <canvas id="activityChart" width="100%" height="50"></canvas>
          </div>
        </div>
        <!-- Recommendations Box -->
        <div class="card">
          <div class="card-header">
            <h5>Recommendations</h5>
          </div>
          <div class="card-body">
            <ul class="list-group">
              {% for rec in recommendations %}
              <li class="list-group-item">{{ rec.recommendation_text }}</li>
              {% else %}
              <li class="list-group-item">No recommendations available.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Add New Task -->
  <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form action="{{ url_for('add_task') }}" method="post">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskModalLabel">Add New Task</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="taskName" class="form-label">Task Name</label>
              <input type="text" class="form-control" id="taskName" name="name" required />
            </div>
            <div class="mb-3">
              <label for="estimatedTime" class="form-label">Estimated Time (mins)</label>
              <input type="number" class="form-control" id="estimatedTime" name="estimated_time" required />
            </div>
            <div class="mb-3">
              <label for="deadline" class="form-label">Deadline</label>
              <input type="datetime-local" class="form-control" id="deadline" name="deadline" />
            </div>
            <div class="mb-3">
              <label for="priority" class="form-label">Priority</label>
              <select class="form-select" id="priority" name="priority">
                <option value="1">Low</option>
                <option value="2" selected>Medium</option>
                <option value="3">High</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Task</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Optional: Chart.js for Weekly Activity Graph -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Example: Initialize Chart.js for the Weekly Activity Graph
    const ctx = document.getElementById('activityChart').getContext('2d');
    const activityChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Tasks Completed',
          data: [12, 19, 3, 5, 2, 3, 7], // Replace with dynamic data as needed
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
